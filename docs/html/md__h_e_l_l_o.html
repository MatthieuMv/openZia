<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>openZia: Hello World example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="oZ.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">openZia
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">C++ 17 API for Epitech&#39;s Zia project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Hello World example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>As the pipeline is already implemented, you will not need a lot of work to get a first "Hello World" example running (meaning more time to develop great modules !).</p>
<p><em>Please note that this example is very straightforward and not using advantages of a multithreaded server.</em></p>
<p>I assume you have already setup your sever basic's routine (listen, accept, read ...). Let's say you have a class <b>Server</b>. </p><div class="fragment"><div class="line"> {C++}</div><div class="line">#include &lt;openZia/Pipeline.hpp&gt;</div><div class="line">class Server {</div><div class="line">public:</div><div class="line">    // Set the pipeline module and configuration paths and load modules</div><div class="line">    Server(void) : _pipeline(&quot;ModuleDir&quot;, &quot;ConfigDir&quot;) {</div><div class="line">        _pipeline.loadModules();</div><div class="line">    }</div><div class="line"></div><div class="line">    /* ... Your routines functions ... */</div><div class="line"></div><div class="line">private:</div><div class="line">    /* ... Your members ... */</div><div class="line">    Pipeline _pipeline; // Pipeline loads module</div><div class="line"></div><div class="line">    // Callback when server accept a new client</div><div class="line">    void onClientConnected(const oZ::FileDescriptor fd, const oZ::Endpoit endpoint, bool useEncryption) {</div><div class="line">        _pipeline.onConnection(fd, endpoint, useEncryption);</div><div class="line">    }</div><div class="line"></div><div class="line">    // Callback when server receive disconnection</div><div class="line">    void onClientDisconnected(const oZ::FileDescriptor fd, const oZ::Endpoit endpoint) {</div><div class="line">        _pipeline.onDisconnection(fd, endpoint);</div><div class="line">    }</div><div class="line"></div><div class="line">    // Callback when server receives a message</div><div class="line">    void onPacketReceived(const oZ::FileDescriptor fd, oZ::ByteArray &amp;&amp;buffer, const oZ::Endpoint endpoint) {</div><div class="line">        oZ::Context context(oZ::Packet(std::move(buffer), endpoint, fd));</div><div class="line">        _pipeline.runPipeline(context);</div><div class="line">        sendResponseToClient(context);</div><div class="line">    }</div><div class="line"></div><div class="line">    // Send the HTTP response to the client</div><div class="line">    void sendResponseToClient(const Context &amp;context) {</div><div class="line">        /* You may use the following methods:</div><div class="line">            context.hasError() // Fast error checking</div><div class="line">            context.getEndpoint() // Get the endpoint of target client</div><div class="line">            context.getResponse() // Get the response result of the pipeline</div><div class="line">        */</div><div class="line">    }</div><div class="line">};</div></div><!-- fragment --><p>Now you need to create your first module. Let's create two of them as a demonstration of dependency handling : </p><div class="fragment"><div class="line"> {C++}</div><div class="line">/* --- Hello.hpp --- */</div><div class="line">#pragma once</div><div class="line"></div><div class="line">#include &lt;iostream&gt;</div><div class="line"></div><div class="line">#include &lt;openZia/IModule.hpp&gt;</div><div class="line">#include &lt;openZia/Pipeline.hpp&gt; // Not defined in IModule.hpp</div><div class="line"></div><div class="line">class Hello : public oZ::IModule</div><div class="line">{</div><div class="line">public:</div><div class="line">    Hello(void) = default;</div><div class="line">    virtual ~Hello(void) = default;</div><div class="line"></div><div class="line">    virtual const char *getName(void) const { return &quot;Hello&quot;; }</div><div class="line">    virtual Dependencies getDependencies(void) const noexcept { return { &quot;World&quot; }; }</div><div class="line"></div><div class="line">    virtual void onConnection(const FileDescriptor fd, const Endpoint endpoint, const bool useEncryption) {</div><div class="line">        std::cout &lt;&lt; &quot;New client connected: &quot; &lt;&lt; endpoint.getAdrress() &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line"></div><div class="line">    virtual void onDisconnection(const FileDescriptor fd, const Endpoint endpoint, const bool useEncryption) {</div><div class="line">        std::cout &lt;&lt; &quot;Client diconnected: &quot; &lt;&lt; endpoint.getAdrress() &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line"></div><div class="line">    // Register your callback to the pipeline</div><div class="line">    virtual void onRegisterCallbacks(oZ::Pipeline &amp;pipeline) {</div><div class="line">        pipeline.registerCallback(</div><div class="line">            oZ::State::Interpret, // Call at response creation time</div><div class="line">            oZ::Priority::Medium + 1, // With medium priority but higher than &#39;World&#39; module</div><div class="line">            this, &amp;Hello::onInterpret // Member function style</div><div class="line">        );</div><div class="line">    }</div><div class="line"></div><div class="line">private:</div><div class="line">    bool onInterpret(oZ::Context &amp;context) {</div><div class="line">        oZ::Log(oZ::Information) &lt;&lt; &quot;Module &#39;Hello&#39; wrote successfully its message&quot;;</div><div class="line">        context.getResponse().getHeader().set(&quot;Content-Type&quot;, &quot;text/plain&quot;);</div><div class="line">        context.getResponse().getBody() += &quot;Hello&quot;;</div><div class="line">        return true;</div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line">/* --- Hello.cpp --- */</div><div class="line">#include &quot;Hello.hpp&quot;</div><div class="line"></div><div class="line">OPEN_ZIA_MAKE_ENTRY_POINT(Hello);</div></div><!-- fragment --><div class="fragment"><div class="line"> {C++}</div><div class="line">/* --- World.hpp --- */</div><div class="line">#pragma once</div><div class="line"></div><div class="line">#include &lt;openZia/IModule.hpp&gt;</div><div class="line">#include &lt;openZia/Pipeline.hpp&gt; // Not defined in IModule.hpp</div><div class="line"></div><div class="line">// Second module &#39;World&#39;</div><div class="line">class World : public oZ::IModule</div><div class="line">{</div><div class="line">public:</div><div class="line">    World(void) = default;</div><div class="line">    virtual ~World(void) = default;</div><div class="line"></div><div class="line">    virtual const char *getName(void) const { return &quot;World&quot;; }</div><div class="line">    virtual Dependencies getDependencies(void) const noexcept { return { &quot;Hello&quot; }; }</div><div class="line"></div><div class="line">    // Register your callback to the pipeline</div><div class="line">    virtual void onRegisterCallbacks(oZ::Pipeline &amp;pipeline) {</div><div class="line">        pipeline.registerCallback(</div><div class="line">            oZ::State::Interpret, // Call at response creation time</div><div class="line">            oZ::Priority::Medium, // With medium priority</div><div class="line">            [](oZ::Context &amp;context) { // Lambda function style</div><div class="line">                context.getResponse().getBody() += &quot; World&quot;;</div><div class="line">                return true;</div><div class="line">            }</div><div class="line">        );</div><div class="line">    }</div><div class="line"></div><div class="line">    virtual void onLoadConfigurationFile(const std::string &amp;directory) {</div><div class="line">        /* Load module&#39;s configuration if needed, using your own configuration loader */</div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line">/* --- World.cpp --- */</div><div class="line">#include &quot;World.hpp&quot;</div><div class="line"></div><div class="line">OPEN_ZIA_MAKE_ENTRY_POINT(World);</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
