<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>openZia: Pipeline&#39;s Context class</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="oZ.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">openZia
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">C++ 17 API for Epitech&#39;s Zia project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Pipeline's Context class </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Each module of the pipeline implement various callbacks that parse and transform an <b><a class="el" href="classo_z_1_1_h_t_t_p_1_1_request.html">oZ::HTTP::Request</a></b> to create an <b><a class="el" href="classo_z_1_1_h_t_t_p_1_1_response.html" title="The HTTP response inherits from the header.">oZ::HTTP::Response</a></b>. Thus, the pipeline need a way to store each information though the various modules: <b><a class="el" href="classo_z_1_1_context.html" title="The context class uses different concepts : 1) State is a state-machine code which indicates where th...">oZ::Context</a></b>.</p>
<h2>Context creation</h2>
<p>The context can be default created but to make it process-able, you must specify a <b><a class="el" href="classo_z_1_1_packet.html">oZ::Packet</a></b> containing a client endpoint and its message buffer. At this point, you can run the <b><a class="el" href="classo_z_1_1_pipeline.html#a90bddc5511acce66f2aa780c3bba29b4" title="Process a context into the pipeline.">oZ::Pipeline::runPipeline</a></b> function to process the context and create a response out of it. </p><div class="fragment"><div class="line"> {C++}</div><div class="line">// Callback triggered when receiving messages from clients on default HTTP port</div><div class="line">void MyServer::onReceiveNetworkPacket(oZ::Packet &amp;&amp;packet)</div><div class="line">{</div><div class="line">    // Create a context out of a network Packet</div><div class="line">    oZ::Context context(std::move(packet));</div><div class="line"></div><div class="line">    // Run the pipeline with this new context and send its response to the client</div><div class="line">    _pipeline.runPipeline(context);</div><div class="line">    sendResponseToClient(context);</div><div class="line">}</div></div><!-- fragment --><h2>Encryption</h2>
<p>As you may know, HTTP uses default port 80. However, if you want to add encryption to your server exchanges, you must use the default HTTPS port 443. Thus, the context need a way to store an encryption flag (to know if the client uses HTTPS) and an encryption key. This data is contained in the <b><a class="el" href="classo_z_1_1_packet.html">oZ::Packet</a></b> class.</p>
<p>If you use openSSL for the encryption, you may need to use <b>Pipeline::onConnection</b>, <b>Pipeline::onDisconnection</b>, <b>IModule::onConnection</b> and <b>IModule::onDisconnection</b> to implement it as a standalone module.</p>
<div class="fragment"><div class="line"> {C++}</div><div class="line">// Callback triggered when receiving messages from clients on default HTTPS port</div><div class="line">void MyServer::onReceiveEncryptedNetworkPacket(oZ::Packet &amp;&amp;packet)</div><div class="line">{</div><div class="line">    // Create a context out of a network Packet</div><div class="line">    oZ::Context context(std::move(packet));</div><div class="line"></div><div class="line">    // Set the encryption flag in the context</div><div class="line">    context.getPacket().setEncryption(true);</div><div class="line">    // Run the pipeline with this new context and send its response to the client</div><div class="line">    _pipeline.runPipeline(context);</div><div class="line">    sendResponseToClient(context);</div><div class="line">}</div></div><!-- fragment --><h2>Cache handling</h2>
<p>In this section we will see how caching can be achieved if you really wish to go for performances. The <b><a class="el" href="classo_z_1_1_context.html" title="The context class uses different concepts : 1) State is a state-machine code which indicates where th...">oZ::Context</a></b> class has a <b><a class="el" href="classo_z_1_1_context.html#a748147258019436983fdbbf6ed51c0b6" title="Check if the current Context&#39;s state is constant (and if it can be cached)">oZ::Context::isConstant</a></b> function that tells if the current context is constant, and thus can be cached. If some of your modules aren't supporting cache for specific HTTP methods, you can use the <b><a class="el" href="classo_z_1_1_context.html#ada521ec57fbc2febfd61177e8bbc0128" title="Tell that the Context is not constant and thus can&#39;t be cached.">oZ::Context::notConstant</a></b> function to set the constant state to false. It's up to you to implement caching. You can accomplish in by creating a module or by handling it directly in the server. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
